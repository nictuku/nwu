NWU

== NWU development version ==
=============================

Network wide updates for systems which use APT.
- Yves Junqueira <yves@cetico.org>

https://dev.ubuntubrasil.org/trac/nwu

NWU features
-------------

# Manage Debian-like systems in the network using a CLI tool 
  (PyGTK interface under development)
# Install packages in the remote computers
# List pending updates
# Roll security upgrades to computers
# Update the remote nodes packages cache

The nodes talks to the server using SSL+XML-RPC regularly, sending changes
in APT repositories, list of installed softwares and even pending updates.

All those information are stored in the server's database, which can be
either PostgreSQL, MySQL or SQLite, and the can be viewed using a CLI
tool or with a GTK tool, still in early development stages.

If the nwu operator wants so, he or she can trigger tasks to be executed
in the remote computers, like install packages, update the APT cache or
upgrade the system.

= NWU Server =
==============

NWU Server is used to control computers that have nwu agent installed. 

It must be configured to use a database system and have a SSL certificate
in place.

= Nwu-server installation =
===========================

SSL Certificate File
--------------------

The SSL certificate is created when the nwu-server package is installed.
If you want to replace the certificate created, it's located in
/etc/nwu/server.pem

Database setup
--------------

In order to use nwu-server you need a database backend compatible with python
sqlobject (MySQL, PostgreSQL, SQLite).

SQLite is used by default. If you want to use MySQL or PostgreSQL instead, 
this is what you should do:

1) Update /etc/nwu/server.conf database settings

1.1) - MySQL -

Create database:

CREATE DATABASE nwu;

Create user:

GRANT ALL PRIVILEGES ON nwu.* TO 'nwu'@'%' IDENTIFIED BY 'YOURPASSWORD' WITH GRANT OPTION;

Create tables:

# nwu-server -i

This command will create all required tables and then exit. Check the syslog
for problems.

1.2) - PostgreSQL -

sudo -u postgres createuser nwu
sudo -u postgres createdb nwu
sudo -u postgres psql nwu << EOF
ALTER DATABASE nwu OWNER TO nwu
\q
EOF

To populate the tables:

# nwu-server -i

It will create all required tables and then exit. Check the syslog for 
possible problems.

Nwu-server config file
----------------------

You have to configure nwu-server parameters in the /etc/nwu/server.conf file.
This file must only be readable by the nwuserver user, since it has sensitive
information like database user and password.

The webservice section defines in what address and port nwu-server will listen 
for connections from the clients.

In the database section you'll define database settings, but that is pretty
straightforward, as you can see in this sample config file.

Sample config file:

-----------------------
[webservice]

host = 0.0.0.0
port = 8088

[database]
type = sqlite
host =
database = /var/lib/nwu/nwu.db
user =
password =

#type = mysql
#host = localhost
#database = nwu
#user = nwu
#password = PASSHERE
------------------------

Start the server
----------------

nwu-server comes with a init script.

The init calls nwu-server which daemonizes itself. It creates a pid file in 
/var/run/nwu-server/nwu-server.pid and goes to the background. Check the 
syslog to see if everything went fine.

nwu-server also has some command-line options. For example, to run it
in the foreground and see the logs in stderr, run it with the '-f'
parameter.

For more options, type:

# nwu-server -h

Nwu admin CLI tool
------------------

In order to manage nwu, in the current version, the admin must be a member
of the nwuserver group, so he/she can read /etc/nwu/server.conf and use
that information to connect to the database.

adduser johndoe nwuserver

In later versions all management activities will use XML-RPC calls, so you will
will be able to use nwu admin tools (both CLI and PyGTK) from a remote machine.


Troubleshooting
---------------

If nwu-server is behaving strangely, you can use the "-e" parameter to
redirect python errors what would be sent to /dev/null to a log file,
and then see what's happening. I hope this ugly feature will not be necessary
in later versions of NWU, and all logs would be sent either to syslog OR
to stdout.

Feedback
--------

Please send all feedback to yves@cetico.org 

The project bugs are managed in a trac, placed in
https://dev.ubuntubrasil.org/trac/nwu

Please file any bugs there.

Thank you,

Yves Junqueira
<yves@cetico.org>
